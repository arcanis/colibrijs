var Colibri=new (function(){var i=this;function m(a){return Math.floor(a)}function j(a){return Math.abs(a)}function l(a){return Math.sqrt(a)}function n(a){return Math.pow(a,2)}function o(a){return[a[0]*0.299+a[1]*0.587+a[2]*0.114,a[0]*-0.147+a[1]*0.289+a[2]*0.436,a[0]*0.615+a[1]*0.515+a[2]*0.1]}function k(a,b){var c=o(a),d=o(b);return l(n(c[0]-d[0])+n(c[1]-d[1])+n(c[2]-d[2]))}function p(a){return l(n(a[0])*0.241+n(a[1])*0.691+n(a[2])*0.068)}this.filters={hex:function(b){var a=function(c){var d=Math.floor(255*c).toString(16);return d.length===1?"0"+d:d};return"#"+b.map(a).join("")},css:function(a){return"rgb("+a.map(function(b){return Math.floor(255*b)}).join(",")+")"}};this.gatherSimilarElements=function(c,r){var d=[];for(var a=0,f=c.length;a<f;++a){var e=c[a];var h=null;for(var b=0,g=d.length;b<g;++b){if(r(d[b][0],e)){break}}if(b===g){h=[];d.push(h)}else{h=d[b]}h.push(e)}return d};this.meanColor=function(a){var b=[0,0,0];for(var c=0,d=a.length;c<d;++c){var e=a[c];b[0]+=e[0];b[1]+=e[1];b[2]+=e[2]}b[0]/=a.length;b[1]/=a.length;b[2]/=a.length;return b};this.dominantColor=function(d,a,b){if(typeof a==="undefined"){a=0.1}if(typeof b==="undefined"){b=null}var c=i.gatherSimilarElements(d,function(f,g){return k(f,g)<a}).sort(function(g,f){return f.length-g.length});var e=i.meanColor(c.shift());if(b===null){return e}if(b===-1){b=c.length}return c.slice(0,b).map(function(f){return i.meanColor(f)})};this.createCanvas=function(){return document.createElement("canvas")};this.loadDataFromContext=function(d,h,c,e,r,b){var f=h.getImageData(c,e,r,b).data;for(var a=0,g=f.length;a<g;a+=4){d.push([f[a+0]/255,f[a+1]/255,f[a+2]/255])}};this.extractImageColors=function(g,a){var c=i.createCanvas();var b=c.getContext("2d");c.width=g.width;c.height=g.height;b.drawImage(g,0,0,c.width,c.height);var d=[];i.loadDataFromContext(d,b,0,0,c.width-1,1);i.loadDataFromContext(d,b,c.width-1,0,1,c.height-1);i.loadDataFromContext(d,b,0,1,1,c.height-1);i.loadDataFromContext(d,b,1,c.height-1,c.width-1,1);var f=[];i.loadDataFromContext(f,b,0,0,c.width,c.height);var e=i.dominantColor(d,0.1);var h=i.dominantColor(f,0.1,-1).filter(function(r){return j(p(e)-p(r))>0.4}).reduce(function(t,v){var u=t[t.length-1];if(!u||k(u,v)>0.3){t.push(v)}return t},[]);if(a&&typeof a!=="function"){a=i.filters[a]}if(a){e=a(e);h=h.map(function(r){return a(r)})}return{background:e,content:h}};this.extractBackgroundColor=function(f,a){var c=i.createCanvas();var b=c.getContext("2d");c.width=f.width;c.height=f.height;b.drawImage(f,0,0,c.width,c.height);var d=[];i.loadDataFromContext(d,b,0,0,c.width-1,1);i.loadDataFromContext(d,b,c.width-1,0,1,c.height-1);i.loadDataFromContext(d,b,0,1,1,c.height-1);i.loadDataFromContext(d,b,1,c.height-1,c.width-1,1);var e=i.dominantColor(d,0.1);if(a&&typeof a!=="function"){a=i.filters[a]}if(a){e=a(e)}return e}});
